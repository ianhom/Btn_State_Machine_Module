# Btn_State_Machine_Module
## Introduce:
一直在做代码模块化的工作，分享一个自己写的按键扫描模块，欢迎大家试用
本模块计划长期更新，本人能力有限，有错误之处欢迎指正交流，我将根据大家的反馈进行修改优化，提供更可靠的软件模块给大家。

## 说明：
本模块可灵活配置如下参数：
* 按键数量；
* 按键常开常闭类型（未按下时稳态值）；
* 按键检测使能/非能控制；
* 按键去抖时间；
* 按键长按识别时间；
* 每个按键独立的按键状态获取函数。
   
本模块可以为上层提供：
* 按键事件（瞬态）：
  * BTN_PRESSED_EVT        按键刚被短按；
  * BTN_LONG_PRESSED_EVT   按键刚被长按；
  * BTN_S_RELEASED_EVT     按键刚从短按状态下释放；
  * BTN_L_RELEASED_EVT     按键刚从长按状态下释放。
  
* 按键状态（稳态）：
  * BTN_IDLE_ST            按键处于空闲状态（未按下）；
  * BTN_PRESS_AFT_ST       按键处于短按状态；
  * BTN_HOLDING_ST         按键处于长按状态。

## 资源消耗参考：
M0+内核 + IAR 下 Low优化等级：  

 内容 | 区域 | 大小 | 说明                                                  
 ------------ | ------------ | ------------ | -------------
 代码 | Flash | 468字节 | 程序416字节 + 52字节的状态转移表                                                    
 配置参数/状态/接口变量 | RAM静态储存区 | n*20 + 8字节 | n为按键数量  
 临时变量/函数调用开销 | RAM栈区域 | 40字节 | 无   
         
## 使用方法：
1. 将Btn_SM_Module.c文件导入IDE工程，增加Btn_SM_Module.h的包含路径。
2. 修改Btn_SM_Module.h中MAX_BTN_CH的值为按键数量（或在该模块上层重新定义该宏，推荐!）
3. 编写系统时间获取函数，函数要求见Btn_SM_Module.h
4. 编写按键状态（逻辑1/0）获取函数，函数要求见Btn_SM_Module.h。注意这里可以通过宏定义__BTN_SM_SPECIFIED_BTN_ST_FN来选择使用同一的按键状态获取函数或每个按键独立的按键状态获取函数。
5. 复制Btn_SM_Module.h中的Demo代码，创建配置参数的结构体并根据要求进行初始化配置（去抖时间，长按时间，按键常态、是否使能按键）
6. 调用一次Btn_General_Init()进行通用初始化
7. 调用n次"Btn_Channel_Init()"进行各个按键通道的初始化（n为按键数量）
8. 轮询Btn_Channel_Process()进行各个按键通道的状态，通过该函数返回值确定按键返回状态：短按、长按、短按释放、长按释放及无状态。
9. 通过Btn_Func_En_Dis()可在初始化之后屏蔽或启用按键功能。
